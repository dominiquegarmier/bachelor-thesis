\chapter{Hierarchical Clustering Functors}
\label{chapter__hierarchical}
In this chapter we first establish a link between \emph{scaling} hierarchical clustering functors and regular spanning classical clustering functors.
%
With this, we can then tackle the modified \textsc{Kleinberg} conditions presented in \cite[Sec.~7.3.1]{Carlsson2010}.
We prove that these conditions uniquely characterize the hierarchical Vietoris-Rips clustering functor $\Rf$ from Example \ref{exa:hierarchical_vr}. \textsc{Carlsson} and \textsc{M\'emoli} already proved a similar result where \textsc{Kleinberg}s assumption of surjectivity was replaced by other conditions \cite[Thm.~18]{JMLR:v11:carlsson10a}.

% \begin{definition}{Vietoris-Rips Functor \cite[Ex.~7.1]{Carlsson2010}}{hierarchical_vr}
% For $\M \in \{\gen,\inj,\iso\}$ we can define the Vietoris-Rips hierarchical clustering functor by
% $$
% \Rf\colon \M \to \H
% $$
% where for $(X,d) \in \ob(\M)$ and $\delta \in \R_{\geq0}$ we set
% $$
% \Rf(X,d; \delta) := \Rf_\delta(X,d).
% $$
% \end{definition}
% Notice that since $\Rf_\delta \refines \Rf_{\delta'}$ for $\delta \leq \delta'$, this is indeed a hierarchical functor.

Similar to classical clustering functors, we also want to define some properties for hierarchical clustering functors.

\begin{definition}{}{}
    A hierarchical clustering functor $\Hf$ is said to be \emph{surjective} if for every ${(X, \theta) \in \ob(\H)}$ there exists a metric $d$ on $X$ such that $\Hf(X,d) = (X, \theta)$.
\end{definition}

\begin{myremark}{}{hierarchical_to_classical_surjective}
Notice that given a surjective hierarchical clustering functor $\Hf$, any $t \in \R_{\geq0}$ induces a surjective classical clustering functor
$$
\Cf_t(X,d) := \Hf(X, d; t).
$$
\end{myremark}


To discuss a similar notion as scale invariance we need to introduce the following functor.

\begin{definition}{\cite[Ex.~4.3]{Carlsson2010}}{shift_functor}
We define the \emph{shift} functor $s_\lambda\colon \H \to \H$ for some $\lambda > 0$. Given $(X, \theta) \in \ob(\H)$ we set
$$
s_\lambda(X, \theta) := (X, \theta^\lambda)
$$
where $\theta^\lambda(r) := \theta(\frac{r}{\lambda})$ for all $r \in \R_{\geq0}$.
By checking the condition on morphisms in Definition \ref{def:output_hierarchical_clustering_functors}, we see that this induces a functor.
\end{definition}

Instead of scale invariance we can ask that this shift functor behaves nicely with scaling of the metric.

\begin{definition}{}{}
Let $\M \in \{\iso,\inj,\gen\}$. A hierarchical clustering functor $\Hf\colon \M \to \H$ is called \emph{scaling} if for all ${(X,d) \in \ob(\M)}$ and $\lambda > 0$ we have
$$
\Hf(X, \lambda \cdot d) = s_\lambda \Hf(X,d).
$$
\end{definition}

In other words, $\Hf$ is scaling if for all $r \in \R_{\geq0}, \lambda > 0$ and $(X,d) \in \ob(\M)$ we have
$$
\Hf(X, \lambda \cdot d; r) = \Hf(X,d; r \lambda^{-1}).
$$

\begin{proposition}{\cite[Sec.~7.3.1]{Carlsson2010}}{}
The Vietoris-Rips functor $\Rf\colon \M \to \H$ is surjective and scaling.
\end{proposition}

\begin{proof}
Let $X$ be a finite set and $\theta: \R_{\geq0} \to \P(X)$ be a dendrogram. For any $x,y \in X$ we can define
$$
\mathfrak{d}(x,y) := \inf\{r \in \R_{\geq0}: x \sim_{\theta(r)} y\}.
$$
Using this we define the metric:
$$
d(x,y) := \inf\left\{\sum_{k=1}^{n-1} \mathfrak{d}(x_k, x_{k+1}): \forall n \in \N \ \forall x = x_1, \dots, x_n = y\right\}.
$$
It is easy to verify that $\Rf(X,d) = (X,\theta)$. Thus, $\Rf$ is surjective. The fact that $\Rf$ is scaling follows directly from its definition.
\end{proof}



Extending the Vietoris-Rips functor to a hierarchical clustering functor can be done more generally for any regular spanning classical clustering functor.
\begin{proposition}{}{scaling_extension_correspondence}

Let $\M \in \{\gen,\inj\}$. Then there exists a one to one correspondence between
scaling hierarchical clustering functors and regular spanning\footnote{Recall definitions \ref{def:regular} and \ref{def:spanning}.} classical clustering functors.

\medskip
More precisely given a regular spanning classical clustering functor $\Cf\colon \M \to \C$ there exists a unique scaling hierarchical clustering functor $\Hf_\Cf\colon \M \to \H$ such that we have
$$
\Hf_\Cf(X,d; 1) = \Cf(X,d)
$$
for all $(X,d) \in \ob(\M)$.
Moreover, any scaling hierarchical clustering functor is of this form.
\end{proposition}

\begin{proof}
Given a regular spanning classical clustering functor $\Cf\colon \M \to \C$ we can define
$$
\Hf_\Cf(X,d; r) := \Cf(X, r^{-1} \cdot d)
$$
for all $(X,d) \in \ob(\M)$ and $r \in \R_{\geq0}$.

To show that this is indeed a hierarchical clustering functor it remains to show that $\Hf_\Cf(X,d;r)$ is a dendrogram (recall Definition \ref{def:dendrogram}).
\begin{enumerate}
    \item Since for $r \leq r'$ the identity map $\id: (X, r^{-1} \cdot d) \to (X, r'^{-1} \cdot d)$ is distance non-increasing and thus by functoriality of $\Cf$, we have
    $$
    \Hf_\Cf(X,d;r) = \Cf(X, r^{-1} \cdot d) \refines \Cf(X, r'^ \cdot d) = \Hf_\Cf(X,d;r').
    $$
    
    \item Since by assumption $\Cf$ is spanning we can find $r,s \in \R_{\geq0}$ such that
    $$
    \Hf_\Cf(X,d;r) := \Cf(X, r d) \quad \text{and} \quad \Hf_\Cf(X,d;s) := \Cf(X, s d)
    $$
    are trivial and discrete respectively.

    \item For this we use the regularity of $\Cf$ and recall Remark \ref{rem:regularity_classical_clustering_functors}.
\end{enumerate}

It is clear that $\Hf_\Cf$ is scaling since for all $r \in \R_{\geq0},\lambda > 0$ and $(X,d) \in \ob(\M)$ we have
$$
\Hf_\Cf(X, \lambda \cdot d; r) = \Cf(X, r^{-1} \lambda \cdot d) = \Hf_\Cf(X,d;r \lambda^{-1}).
$$ 

On the other hand, given any scaling hierarchical clustering functor $\Hf\colon \M \to \H$ we can take $\Cf(X,d) := \Hf(X,d; 1)$ which is a regular spanning classical clustering functor such that $\Hf = \Hf_\Cf$.
\end{proof}

\begin{example}{}{shift_of_vietoris_rips}
Using this notation, we get
$$
\Rf = \Hf_{\Rf_1}.
$$
Moreover, for $\lambda > 0$ and the shift functor $s_\lambda$ we get that
$$
s_\lambda \Rf = s_\lambda \Hf_{\Rf_1} = \Hf_{\Rf_{1/\lambda}}.
$$
\end{example}

\section{Kleinberg's Conditions}

\textsc{Carlsson} and \textsc{M\'emoli} noticed that \textsc{Kleinberg}'s impossibility conditions can be interpreted in the context of hierarchical clustering functors \cite[Sec.~7.3.1]{Carlsson2010}.

\begin{definition}{Modified Kleinberg Conditions \cite[Sec.~7.3.1]{Carlsson2010}}{}
    We say that a hierarchical clustering $\Hf\colon \M \to \H$ functor fulfills the \emph{modified Kleinberg conditions} if all the following holds:
    \begin{enumerate}
        \item $\Hf$ is $\gen$ functorial (\ie\ $\M = \gen$),
        \item $\Hf$ is surjective,
        \item $\Hf$ is scaling.
    \end{enumerate}
\end{definition}

We have seen in the above statements that $\Rf$ fulfills the modified \textsc{Kleinberg} conditions.
Using the uniqueness result of Theorem \ref{thm:uniqueness_of_surjective_regular_functors}, we can now show that the modified \textsc{Kleinberg} conditions uniquely characterize the Vietoris-Rips functor.

\begin{theorem}{Uniqueness of Kleinberg's Conditions}{kleinbergs_uniqueness_conditions}
    Let $\Hf\colon \M \to \H$ be a hierarchical clustering functor that fulfills the modified \textsc{Kleinberg} conditions. Then we have
    $$
    \Hf = s_\delta \Rf
    $$
    for some $\delta > 0$.
\end{theorem}

\begin{proof}
Let $\Hf\colon \M \to \H$ be a hierarchical clustering functor fulfilling the modified \textsc{Kleinberg} conditions. In particular, we have $\M = \gen$.

By proposition \ref{prop:scaling_extension_correspondence}, there exists a regular spanning classical functor ${\Cf\colon \gen \to \C}$ such that $\Hf = \Hf_\Cf$.
Since $\Hf$ is surjective and by Remark \ref{rem:hierarchical_to_classical_surjective}, we have that $\Cf$ is also surjective.
Applying Theorem \ref{thm:uniqueness_of_surjective_regular_functors}, we see that $\Cf = \Rf_{\lambda}$ for some $\lambda > 0$.


Recall Example \ref{exa:shift_of_vietoris_rips}. Using $\delta := 1/\lambda$, we can then see that
$$
\Hf = \Hf_{\Rf_\lambda} = s_\delta \Hf_{\Rf_1} = s_\delta \Rf.
$$
\end{proof}
