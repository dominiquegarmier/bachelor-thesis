\chapter{Clustering Functors}
\label{chapter__clustering_functor}

In this chapter we introduce the notion of a \emph{clustering functor}.
We will use the language of categories and build upon the discussion in section \ref{seciton__preserving_structure}, where we thought of clustering algorithms as preserving certain structures.
Ultimately a clustering functor will be a functor, with certain properties, from a category of finite metric spaces to a category of partitions.
This construction closely follows the one by \textsc{Carlsson} and \textsc{M\'emoli} \cite{Carlsson2010}.

\section{Finite Metric Spaces}
\label{section__finite_metric_spaces}

\begin{definition}{Finite Metric Spaces}{}
We define three categories $\iso, \inj$ and $\gen$ all sharing the same objects:

\begin{equation*}
\ob(\M) := \{(X,d_X): \text{$X$ a finite non-empty set and $d_X$ a metric}\}
\end{equation*}

The three categories are distinguished by their morphisms. For $A, B \in \ob(\M)$ we set:
\begin{itemize}
    \item $\mor_\gen(A,B)$ the distance non-increasing functions $f: A \to B$.
    \item $\mor_\inj(A,B)$ the distance non-increasing injective functions $f: A \to B$.
    \item $\mor_\iso(A,B)$ the isometries $f: A \to B$.
\end{itemize}
The composition of morphisms is given by the composition of functions and the identity morphism is the identity function.
\end{definition}

Depending on what kind of structures we want to preserve we can choose one of the three categories.
By construction, we have the inclusions
\begin{equation}
    \label{eq:inclusions_of_finite_metric_space_categories}
    \iso \subset \inj \subset \gen.
\end{equation}
Furthermore, this inclusion yields functors $\iso \to \inj \to \gen$.

\begin{myremark}{}{}
$\iso$ is the category with the fewest morphisms. Indeed, between most objects there are no morphisms.
All morphisms are within the same isometry class and have an inverse.\par
\medskip
$\gen$ has the most morphisms. In particular for any metric spaces $A,B \in \ob(\gen)$ we have the morphism
$$
\mathrm{const}_b: A \to B, \ a \mapsto b
$$
for some $b \in B$.
\end{myremark}

\section{Partitions and Dendograms}
\label{section__partitions}

\begin{definition}{Partitions of Finite Sets}{}
Let $X$ be a finite set. A partition $P$ of $X$ is the set of equivalence classes $X/_{\sim_P}$ for some equivalence relation $\sim_P$ on $X$. The set of all such partitions is denoted by $\P(X)$.\par

\medskip Furthermore:
\begin{itemize}
    \item We interchangeably use $P$ - the partition and $\sim_P$ - the corresponding equivalence relation.
    \item A single equivalence class $X_\alpha \in P$ will be called a \emph{block} of $P$.
\end{itemize}
\end{definition}

It naturally makes sense to use partitions as outputs of clustering algorithms, where a block of a partition is to be interpreted as a \emph{cluster}.

At this point we need some additional structure that will allow us to define categories based on partitions.

\begin{definition}{}{}
Let $f: X \to Y$ be a map. For some partition $P \in \P(Y)$ we define $f^*(P) \in \P(X)$ to be the partition such that
\begin{equation*}
    \forall x,y \in X: x \sim_{f^*(P)} y \iff f(x) \sim_P f(y).
\end{equation*}
We call $f^*(P)$ the \emph{pullback partition of $P$ w.r.t. $f$}.
\end{definition}

Additionally, we can define a partial order on $\P(X)$.

\begin{definition}{}{}
Let $P, Q \in \mathfrak{P}(X)$ then we write $P \refines Q$ if
\begin{equation*}
    \forall x,y \in X: x \sim_P y \implies x \sim_Q y.
\end{equation*}
This defines a partial order on $\P(X)$
\end{definition}

\begin{definition}{}{}
We say that $P \in \P(X)$ is:
\begin{enumerate}
    \item \emph{discrete} if $x \sim_P y \iff x = y$.
    \item \emph{trivial} if $x \sim_P y$ for all $x,y \in X$.
\end{enumerate}
\end{definition}

Naturally if $Q$ is discrete and $P$ is trivial then $Q \refines R \refines P$ for all $R \in \P(X)$.

Like in the section $\ref{section__finite_metric_spaces}$ we also want to consider hierarchical clustering.
For this we introduce the notion of a dendogram.

\begin{definition}{Dendogram}{dendogram}
A map $\theta: \R_{\leq0} \to \mathfrak{P}(X)$ with
\begin{itemize}
    \item $\forall r,s \in \R_{\leq0}: r \leq s \implies  \theta(r) \refines \theta(s)$
    \item $\exists r \in \R_{\leq0}$ such that $\theta(r)$ is trivial
    \item $\forall r \in \R_{\leq0} \,\exists \varepsilon > 0$ such that $\theta$ is constant on $[r, r + \varepsilon)$
\end{itemize}
is called a \emph{dendogram}. Sometimes we will refer to the $r$ as being the \emph{scale}.
\end{definition}

This will be familiar to anyone who has seen \emph{persistent homology} where such properties are referred to as \emph{persistence} \cite{Carlsson2014}. 

\begin{myremark}{}{}
Since all our metric spaces are finite we could decide to drop the last requirement in the definition of a dendogram. Dendograms would still have discrete scale \ie\ constant on intervals.
However, it would not be clear what value the dendogram would have at the endpoints of the intervals.
This point will be particularly necessary for some uniqueness theorems we present later.
\end{myremark}

We can finally define the categories which will be the \emph{outputs} of clustering functors.

\begin{definition}{}{output_classical_clustering_functors}
Consider the category $\C$ of outputs of \emph{classical clustering functors}. It is defined by
\begin{equation*}
    \ob(\C) := \{(X, P): X \text{ a finite set and } P \in \P(X)\}
\end{equation*}
and for all $(X,P), (Y,Q) \in \ob(\C)$ we have the morphisms
\begin{equation*}
    \mor_\C((X,P), (Y,Q)) := \{f: X \to Y: P \refines f_*(Q)\}.
\end{equation*}
As before, the composition is given by composition of maps and the identity is the identity map.
\end{definition}

\begin{definition}{}{output_hierarchical_clustering_functors}
Similar to before we define the category $\H$ of outputs of \emph{hierarchical clustering functors}, given by
\begin{equation*}
    \ob(\H) := \{(X, \theta_X): X \text{ a finite set and } \theta_X: \R_{\geq0} \to \P(X) \text{a dendogram}\}
\end{equation*}
and for all $(X, \theta_X), (Y, \theta_Y) \in \ob(\H)$ we have the morphisms
\begin{equation*}
    \mor_\H((X, \theta_X), (Y,\theta_Y)) :=
    \left\{f: X \to Y: \forall r \in \R_{\geq0}: \theta_X(r) \refines f_*(\theta_Y(r)) \right\}
\end{equation*}
the composition and identity are defined as before.
\end{definition}

Another way of thinking about morphisms in $\H$ is that given $(X,P), (Y,Q) \in \ob(\C)$, $f \in \mor_\H((X,P), (Y,Q))$ is simply a map $f: X \to Y$ such that
$$
\forall x,y \in X: x \sim_P y \implies f(x) \sim_Q f(y).
$$

\section{Clustering Functors}
\begin{definition}{Clustering Functor}{}
Let $\M \in \{\iso, \inj, \gen\}$ and $\A \in \{\C, \H\}$. An $\M$-functorial \emph{clustering functor} (or $\M$ clustering functor) is a functor from $\M$ to $\A$
$$\Cf : \M \longrightarrow \A$$
such that $\Cf$ factorizes the forgetful functors (see \ref{not:factorizing_forgetful_functor}) \par

\medskip If $\A = \C$ we say that $\Cf$ is \emph{classical} and otherwise if $\A = \H$ we say it is \emph{hierarchical}.
\end{definition}


\begin{myremark}{}{induced_functor_by_inclusion}
Recall the inclusions \eqref{eq:inclusions_of_finite_metric_space_categories} and their induced functors.
Given a clustering functor on a larger category, say $\Cf: \gen \to \C$, this immediately induces clustering functors on the smaller categories by pre-composition with the inclusion functors $\iso \to \inj \to \gen$. We will use the same symbol for the induced functors.
\end{myremark}

With this in mind it makes sense to think of the categories $\iso, \inj, \gen$ as being different levels of \emph{structure} a clustering functor can \emph{preserve} where $\iso$ is the least restrictive and $\gen$ the most restrictive.