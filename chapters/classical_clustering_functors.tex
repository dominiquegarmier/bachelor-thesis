\chapter{Classification of Classical Clustering Functors}
\label{chapter__classical}
In this chapter, any clustering functor is of the classical type.
An important (classical) clustering functor is the Vietoris-Rips functor.
In particular, we will later see that it exhibits certain unique properties.

\begin{defprop}{Vietoris-Rips Functor \cite[Def.~6.1]{Carlsson2010}}{classical_vr}
    Let $\delta > 0$ and $\M \in \{\iso, \inj, \gen\}$. The Vietoris-Rips functor $\Rf_\delta: \M \to \C$ assigns to each metric space $(X,d) \in \M$ the partition $(X,P)$ where $\sim_P$ is the equivalence generated by:
    \begin{equation}
        \label{eq:vietoris_rips_equivalence_relation}
        \forall x,y \in X: d(x,y) \leq \delta \implies x \sim_P y.
    \end{equation}
    \todo[check regularity; this is the single source of truth]
\end{defprop}

One could use a proper inequality in \eqref{eq:vietoris_rips_equivalence_relation}. The entire theory we are about to present would still hold, provided we tweak certain definitions accordingly, in particular, definition \ref{def:dendrogram}.

\begin{proof}
It is sufficient to show that $\Rf_\delta$ is $\gen$-functorial. By remark \ref{rem:induced_functor_by_inclusion} functoriality over $\iso$ and $\inj$ will follow.

Let $X,Y \in \ob(\gen)$ and $(X,P) := \Rf_\delta(X)$ as well as $(Y,Q) := \Rf_\delta(Y)$.
Take any $f \in \mor_\gen(X,Y)$, recall that $f$ is distance non-increasing.
We have to show that 
$$P \refines_f Q.$$
Indeed, let $x,y \in X$ such that $d(x,y) \leq \delta$.
Then, we have $d(f(x), f(y)) \leq d(x,y) \leq \delta$ and therefore $f(x) \sim_{Q} f(y)$.
By taking the transitive closure we get the statement.
\end{proof}

Consider the seven points $\{a,b,c,d,e,f,g\} \subset \R^2$ show in the figure \ref{fig:vietoris_rips_example}. Then, $\Rf_\delta$ creates the clusters $\{a,b,c\}$ and $\{d,e,f,g\}$, shown in red and blue. For clarity, we chose to draw the circles with radius $\delta / 2$, \ie\ two points are in the same cluster if circles around them with radius $\delta / 2$ intersect.

\begin{figure}[h]
\centering
\begin{tikzpicture}[sloped]
    \draw[dashed,fill=mygreen,fill opacity=0.1](2.3, 4.8) node[circle,fill=black,inner sep=1pt,fill opacity=1]{} circle (1);
    \draw[dashed,fill=mygreen,fill opacity=0.1](3.2, 4.0) node[circle,fill=black,inner sep=1pt,fill opacity=1]{} circle (1);
    \draw[dashed,fill=mygreen,fill opacity=0.1](1.7, 3.4) node[circle,fill=black,inner sep=1pt,fill opacity=1]{} circle (1);

    \draw[dashed,fill=mygreen,fill opacity=0.1](0.7, 1.3) node[circle,fill=black,inner sep=1pt,fill opacity=1]{} circle (1);
    \draw[dashed,fill=mygreen,fill opacity=0.1](3.9, 1.3) node[circle,fill=black,inner sep=1pt,fill opacity=1]{} circle (1);
    \draw[dashed,fill=mygreen,fill opacity=0.1](2.1, 1.1) node[circle,fill=black,inner sep=1pt,fill opacity=1]{} circle (1);
    \draw[dashed,fill=mygreen,fill opacity=0.1](3.4, 0.3) node[circle,fill=black,inner sep=1pt,fill opacity=1]{} circle (1);

    \draw[<->, >=stealth, color=mypurple, thick, opacity=0.6] (2.3, 4.8) -- (2.3 - 0.985, 4.8 + 0.174) node[midway, above]{\tiny{$\delta / 2$}};
    %\draw[<->, >=stealth, color=mypurple, thick, opacity=0.4] (3.2, 4.0) -- (3.2 + 0.866, 4.0 - 0.5) node[midway, above]{\tiny{$\delta$}};
    %\draw[<->, >=stealth, color=mypurple, thick, opacity=0.4] (1.7, 3.4) -- (1.7 - 0.174, 3.4 - 0.985) node[midway, above]{\tiny{$\delta$}};

    %\draw[<->, >=stealth, color=mypurple, thick, opacity=0.4] (0.7, 1.3) -- (0.7 - 0.5, 1.3 + 0.866) node[midway, above]{\tiny{$\delta$}};
    %\draw[<->, >=stealth, color=mypurple, thick, opacity=0.4] (3.9, 1.3) -- (3.9 + 0.866, 1.3 + 0.5) node[midway, above]{\tiny{$\delta$}};
    %\draw[<->, >=stealth, color=mypurple, thick, opacity=0.4] (2.1, 1.1) -- (2.1 - 0, 1.1 - 1) node[midway, above]{\tiny{$\delta$}};
    %\draw[<->, >=stealth, color=mypurple, thick, opacity=0.4] (3.4, 0.3) -- (3.4 + 0.866, 0.3 - 0.5) node[midway, above]{\tiny{$\delta$}};

    \draw[myred!50!black, thick, opacity=0.9, fill=myred, fill opacity=0.25] (2.3, 4.8) -- (3.2, 4.0) -- (1.7, 3.4) -- cycle;
    \draw[myblue!50!black, thick, opacity=0.9, fill=myblue, fill opacity=0.25] (3.9, 1.3) -- (2.1, 1.1) -- (3.4, 0.3) -- cycle;
    \draw[myblue!50!black, thick, opacity=0.9] (0.7, 1.3) -- (2.1, 1.1);

    \node[above] at (2.3, 4.8) {$a$};
    \node[above] at (3.2, 4.0) {$b$};
    \node[left] at (1.7, 3.4) {$c$};

    \node[left] at (0.7, 1.3) {$d$};
    \node[right] at (3.9, 1.3) {$e$};
    \node[above] at (2.1, 1.1) {$f$};
    \node[below] at (3.4, 0.3) {$g$};
\end{tikzpicture}
\caption{Clusters (red and blue) produced by the Vietoris-Rips functor $\Rf_\delta$ for on the points $\{a,b,c,d,e,f,g\} \subset \R^2$.}
\label{fig:vietoris_rips_example}
\end{figure}




\begin{myremark}{$\iso$ Clustering Functors \cite[Thm.~6.1]{Carlsson2010}}{}
Let $\mathcal{I}$ denote a collection of representatives of isometry classes of finite metric spaces.
For each $X \in \mathcal{I}$ consider the isometry group $\mathrm{Iso}(X)$. \par

\medskip This group acts on $\mathfrak{P}(X)$ via $(\phi, P) \mapsto \phi_*(P)$.
Let $\Xi_X \subseteq \mathfrak{P}(X)$ denote the set of fixed points of this group action. \par

\medskip A clustering functor $\Cf: \iso \to \C$ is uniquely determined by a choice of $P_X \in \Xi_X$ for each $X \in \mathcal{I}$.
\end{myremark}

Clearly, $\iso$ permits many clustering functors.
In some sense, $\iso$ clustering functors can be thought of as any \emph{algorithm} which \emph{does not consider any particular ordering} of the data points.
This is the reason that algorithms like single linkage clustering \ref{section__linkage_clustering} are not even $\iso$-functorial.

From now on, unless otherwise mentioned, we use $\M \in \{\inj, \gen\}$.

\section{Excessive and Representable Clustering Functors}

\begin{definition}{Excessive Clustering Functors \cite[Def.~6.2]{Carlsson2010}}{}
A clustering functor $\Cf: \M \to \C$ is called \emph{excessive} if for every $(X,d) \in \ob(\M)$ and $(X,P) = \Cf(X,d)$ we have that for every block $X_\alpha \in P$:
$$
\Cf(X_\alpha, d|_{X_\alpha \times X_\alpha}) = (X_\alpha, \{X_\alpha\})
$$
\end{definition}

Let $\Omega$ be a family of finite non-empty metric spaces. Such $\Omega$'s can be used to construct clustering functors. We think of $\Omega$ as being a collection of \emph{patterns} and our clustering algorithm as detecting these \emph{patterns}.

\begin{definition}{Representable Clustering Functors \cite[Sec.~6.2]{Carlsson2010}}{construction_of_representable_clustering_functors}
We define the clustering functor \emph{represented by $\Omega$} as
$$
\Cf^\Omega: \M \to \C
$$
where $\Cf^\Omega(X,d) = (X, P)$ such that $\sim_P$ 
is the equivalence relation generated by
\begin{equation*}
    \forall x,y \in X: \ \exists \omega \in \Omega \,\exists \phi \in \mor_\M(\omega, (X,d)) \ \st \ \{x,y\} \subset \image(\phi) \implies x \sim_P y.
\end{equation*}
Additionally, $\Cf$ is said to be \emph{representable} if there exists some $\Omega$ such that $\Cf = \Cf^\Omega$.
\end{definition}

Let us define a simple metric space that will come in handy on several occasions.
\begin{definition}{}{}
    Let $k \in \N$ and $\delta > 0$. Then, we define the \emph{$k$-simplex} with size $\delta$ as the metric space $\Delta_k(\delta) := (X,d)$ where $X = \{1, \dots, k\}$ and the metric is given by
    $$
    d(i,j) := \begin{cases}
        0 & \text{if } i = j\\
        \delta & \text{otherwise}
    \end{cases} \quad \forall i,j \in X.
    $$
\end{definition}

This gives us an alternative definition of $\Rf_\delta$. \Ie:
$$
\Rf_\delta = \Cf^{\{\Delta_2(\delta)\}}.
$$
The fact that $\Rf_\delta$ is representable is not a coincidence as we will see in the remainder of this section.
\begin{myremark}{\cite[Rem.~6.3]{Carlsson2010}}{}
Notice that for $(X,d) \in \Omega$ we have $\Cf^\Omega(X,d) = (X, \{X\})$.
\end{myremark}

This leads to an alternative characterization of $\Cf^\Omega$.

\begin{proposition}{}{characterization_of_representable}
For any clustering functor $\Cf$ such that $\Cf(X,d)$ is trivial for all $(X,d) \in \Omega$ we have
$$
\Cf^\Omega \refines \Cf
$$
\end{proposition}

\begin{proof}
Let $(X,d) \in \ob(\M)$ and $(X,P) = \Cf^\Omega(X,d)$ and $(X,Q) = \Cf(X,d)$. We want to show that $P \refines Q$.

Let $x,y \in X$ such that the generating condition of $P$ holds. \Ie\ there exists $\omega \in \Omega$ and $\phi \in \mor_\M(\omega, (X,d))$ such that $\{x,y\} \subset \image(\phi)$.

But then since $\Cf(\omega)$ is trivial by assumption and by functoriality $\Cf(\omega) \refines_\phi \Cf(X,d)$, we get that $x \sim_Q y$. Taking the transitive closure gives the statement.


\newresult[check this]
\end{proof}

Importantly, $\Cf^\Omega$ is the finest clustering functor such that $\Cf^\Omega(X,d)$ is trivial for all $(X,d) \in \Omega$. The existence of this minimal clustering functor follows from our initial construction in definition \ref{def:construction_of_representable_clustering_functors}.

\begin{theorem}{\cite[Thm.~6.2]{Carlsson2010}}{}
Let $\M \in \{\inj, \gen\}$. A clustering functor $\Cf: \M \to \C$ is representable if and only if it is excessive.
\end{theorem}

\begin{proof}
First we show that $\Cf^\Omega$ is excessive. So let $(X,d) \in \ob(\M)$ and $(X,P) = \Cf^\Omega(X,d)$ with $X_\alpha \in P$.

Let $x,y \in X_\alpha$ such that there exists $\omega \in \Omega$ and $\phi \in \mor_\M(\omega, (X,d))$ such that $\{x,y\} \subset \image(\phi)$. But now since $X_\alpha$ is a block of $P$ we must have that $\image(\phi) \subset X_\alpha$. Therefore, we can restrict $\phi$, and we have $\phi|_{X_\alpha} \in \mor_\M(\omega, (X_\alpha, d|_{X_\alpha \times X_\alpha}))$. By taking the transitive closure we conclude that $\Cf^\Omega(X_\alpha, d|_{X_\alpha \times X_\alpha}) = (X_\alpha, \{X_\alpha\})$ and $\Cf^\Omega$ is excessive.

It remains to show that any excessive clustering functor is representable. For this consider
$$
\Omega := \{(X_\alpha, d|_{X_\alpha \times X_\alpha}): X_\alpha \in P \text{ for } (X, P) = \Cf(X,d) \text{ and } (X,d) \in \ob(\M)\}.
$$
We will show that $\Cf = \Cf^\Omega$. By proposition \ref{prop:characterization_of_representable} and since $\Cf$ is by definition trivial for all $(X,d) \in \Omega$ we have that $\Cf^\Omega \refines \Cf$. So it remains to show $\Cf \refines \Cf^\Omega$. To this end let $(X,d) \in \ob(\M)$ and $(X,P) = \Cf(X,d)$ and $(X,Q) = \Cf^\Omega(X,d)$.

Assume that $x,y \in X$ are such that $x \sim_P y$. But then by definition, there exists $\omega \subset X$ and $\omega \in \Omega$ such that $\{x,y\} \subset \omega$. Consider the inclusion $\iota: \omega \hookrightarrow X$ which is a morphism in $\mor_\inj(\omega, (X,d))$. Thus by definition of $\Cf^\Omega$, we have $x \sim_Q y$.

\todo[this is a new proof (kinda), check it]
\end{proof}

\section{Surjective Clustering Functors}

\begin{definition}{Surjective Clustering Functors}{}
    A classical clustering functor $\Cf: \M \to \C$ is called \emph{surjective} if for every finite set $X$ and every $P \in \P(X)$ there exists a metric $d$ on $X$ such that

    \begin{equation*}
        \Cf(X,d) = (X,P)
    \end{equation*}

\end{definition}

\begin{proposition}{\cite[Rem.~6.1]{Carlsson2010}}{vietoris_rips_is_surjective}
    The Vietoris-Rips functor $\Rf_\delta$ is surjective.
\end{proposition}
\begin{proof}
Let $X$ be a finite set and $P$ a partition of $X$. Define the metric $d$ on $X$ by
\begin{equation*}
    d(x,y) := \begin{cases}
        0 & \text{if } x = y\\
        \delta & x \neq y \text{ and } x \sim_P y\\
        2\delta & \text{otherwise}
    \end{cases}.
\end{equation*}
It is straightforward to check that this is indeed a metric and that $\Rf_\delta(X,d) = (X,P)$.
\end{proof}

The following property of surjective clustering functors hints that surjectivity and the Vietoris-Rips functor are closely related.


\begin{definition}{}{spanning}
    We say that a clustering functor $\Cf: \M \to \C$ is \emph{spanning} if for every $(X,d) \in \ob(\M)$ we can find $\lambda_0, \lambda_1 > 0$ such that
    \begin{enumerate}
        \item $\Cf(X,\lambda \cdot d)$ is trivial for all $0 < \lambda \le \lambda_0$.
        \item $\Cf(X,\lambda \cdot d)$ is discrete for all $\lambda \ge \lambda_1$.
    \end{enumerate}
\end{definition}

\begin{lemma}{}{surjective_implies_eventually_discrete}
    Let $\Cf: \M \to \C$ be a surjective clustering functor. Then $\Cf$ is spanning.
    \newresult[I need to check this again]
\end{lemma}

For the proof of this lemma we need to introduce the following notation.

\begin{definition}{}{}
    The \emph{separation} of a metric space $(X,d)$ is given by
    \begin{equation*}
    \sep(X,d) := \sep(X) := \begin{cases}
        0 & \text{if } |X| \le 1\\
        \inf\{d(x,y): x,y \in X, x \neq y\} & \text{otherwise}
    \end{cases}
    \end{equation*}
    and the \emph{diameter}
    \begin{equation*}
    \diam(X,d) := \diam(X) := \sup\{d(x,y): x,y \in X\}.
    \end{equation*}
\end{definition}

Notice that for any metric space $(X,d)$ with $1 < |X| < \infty$ we have
$$
0 < \sep(X) \leq \diam(X) < \infty.
$$

\begin{proof}[Proof of Lemma \ref{lem:surjective_implies_eventually_discrete}]
    Let $(X,d) \in \ob(\M)$, we assume that $|X| > 1$ otherwise the statement follows directly. Since $\Cf$ is surjective there exists metrics $d_0, d_1$ on $X$ such that $\Cf(X,d_0)$ is trivial and $\Cf(X,d_1)$ is discrete.

    \begin{enumerate}
        \item We take
        $$
        \lambda_0 := \frac{\sep(X,d_0)}{\diam(X,d)}.
        $$ 
        Notice that for any $\lambda \le \lambda_0$ we have that $\diam(X,\lambda \cdot d) \le \sep(X,d_0)$. Because of this the function
        \begin{align*}
            f: (X, d_0) &\longrightarrow (X, \lambda \cdot d)\\
            x &\longmapsto x
        \end{align*}
        is distance non-increasing (and injective), \ie\ $f \in \mor_\M((X,d_0), (X,\lambda \cdot d))$.
        By functoriality of $\Cf$ it follows that $\Cf(X,d_0) \refines_f \Cf(X,\lambda \cdot d)$. But, since $f$ is the identity on the set $X$ we have $\Cf(X,d_0) \refines \Cf(X,\lambda \cdot d)$ by \eqref{eq:refinement_via_identity}. Therefore, $\Cf(X,\lambda \cdot d)$ must be trivial.

        \item Repeat an analogous argument using
        $$
        \lambda_1 := \frac{\diam(X,d_1)}{\sep(X,d)}.
        $$
        But this time consider for $\lambda \ge \lambda_1$ the function
        \begin{align*}
            f: (X, \lambda \cdot d) &\longrightarrow (X, d_1)\\
            x &\longmapsto x.
        \end{align*}
        We conclude since we have $\Cf(X,\lambda \cdot d) \refines \Cf(X,d_1)$ for the same reason as above. 
        
        \newresult[check this]
    \end{enumerate}
\end{proof}

\section{Splitting}

As observed by \cite[Thm.~6.4]{Carlsson2010} a characterizing property of the Vietoris-Rips functor is its behavior on the space $\Delta_2(\lambda)$. In particular, we have that $\Rf_\delta(\Delta_2(\lambda))$ is trivial if and only if $\lambda \le \delta$ and discrete otherwise.
This motivates the following definition.

\begin{definition}{}{}
    A clustering functor $\Cf: \M \to \C$ is called \emph{splitting} at $\delta_0 > 0$ if we have
    \begin{enumerate}
        \item $\Cf(\Delta_2(\delta))$ is trivial for all $\delta \leq \delta_0$,
        \item $\Cf(\Delta_2(\delta))$ is discrete for all $\delta > \delta_0$.
    \end{enumerate}
\end{definition}

We can now formulate two results that show to what extent splitting is a characterizing property of the Vietoris-Rips functor for $\M \in \{\inj, \gen\}$ \cite[Thm.~6.4]{Carlsson2010}.

\begin{proposition}{}{splitting_vietoris_inj}
    Let $\Cf: \inj \to \C$ be a clustering functor that splits at $\delta > 0$. Then we have 
    $$
    \Rf_\delta \refines \Cf.
    $$
\end{proposition}


\begin{proposition}{}{splitting_vietoris_gen}
    Let $\Cf: \gen \to \C$ be a clustering functor then $\Cf$ is splitting at $\delta > 0$ if and only if 
    $$
    \Cf = \Rf_\delta
    $$
\end{proposition}

\begin{proof}[Proof of Proposition \ref{prop:splitting_vietoris_inj}]
    Let $(X,d) \in \ob(\inj)$ with $(X,P) = \Cf(X,d)$ and $x \neq y$ in $X$ with $d(x,y) \leq \delta$.
    Then there is a map $f \in \mor_\inj(\Delta_2(\delta), (X,d))$ with $\{x,y\} = \image(f)$.
    Since $\Cf(\Delta_2(\delta))$ is trivial we have by functoriality that $x \sim_P y$

    Taking the transitive closure we get that $\Rf_\delta(X,d) \refines P$ and the statement follows by generality of $(X,d)$.
\end{proof}

\begin{proof}[Proof of Proposition \ref{prop:splitting_vietoris_gen}]
    For the converse we notice that clearly $\Rf_\delta$ is splitting at $\delta$.

    \medskip
    Let $\Cf$ be splitting at $\delta$. In view of the previous proposition it remains to show that $\Cf \refines \Rf_\delta$.
        
    Let $(X,d) \in \ob(\gen)$ with $(X,P) = \Cf(X,d)$ and $(X,R) = \Rf_\delta(X,d)$. We will show that $P \refines R$, more precisely we show that for all $x,y \in X$ we have $x \not\sim_R y \implies x \not\sim_P y$. For this we define
    $$
    \delta_0 := \min\{d(x,y): x,y \in X \text{ and } x \not\sim_R y\}
    $$
    Let now $x,y \in X$ such that $x \not\sim_R y$.
    Then we can find a map $f \in \mor_\gen((X,d), \Delta_2(\delta_0))$ such that $f(x) \neq f(y)$\footnote{One particular way to construct such an $f$ would be to send every $x' \sim_R x$ to one point in $\Delta_2(\delta_0)$ and every $x' \not\sim_R x$ to the other point. By the way, we defined $\delta_0$ this map is in fact distance non-increasing.}.

    Since $\delta_0 > \delta$ and $\Cf$ is splitting we get $f(x) \not\sim f(y)$ so by functoriality we have $x \not\sim_P y$.
\end{proof}

\begin{example}{}{}
In some sense, the two previous propositions are the best we can get. \todo[elaborate on this?]

For $\delta>0$ consider the clustering functor $\bar\Rf_\delta: \inj \to \C$ defined by
$$
\bar\Rf_\delta(X,d) := \Rf_{\frac{\delta|X|}{2}}(X,d).
$$
$\bar\Rf_\delta$ is splitting at $\delta$.

\medskip
To see that $\bar\Rf_\delta$ is indeed a clustering functor consider metric spaces $(X,d), (Y,d') \in \ob(\inj)$ and a morphism $f \in \mor_\inj((X,d), (Y,d'))$. By injectivity of $f$ we immediately get that $|X| \le |Y|$. And we have
$$
\bar\Rf_\delta(X,d) = \Rf_{\frac{\delta|X|}{2}}(X,d) \overset{(1)}\refines \Rf_{\frac{\delta|Y|}{2}}(X,d) \overset{(2)}\refines_f \Rf_{\frac{\delta|Y|}{2}}(Y,d') = \bar\Rf_\delta(Y,d'),
$$
where $(1)$ follows from the fact that $|X| \le |Y|$ and $(2)$ follows from the fact that $\Rf_{\delta'}$ is $\inj$ functorial for any $\delta' > 0$. Therefore, $\bar\Rf_\delta$ is an $\inj$ clustering functor.

\medskip
Using a similar argument to the one we used to show that $\Rf_{\delta'}$ is surjective we can also show that $\bar\Rf_\delta$ is surjective.

\newresult[this is a new construction, check it]
\end{example}

\section[Vietoris-Rips Uniqueness]{Vietoris-Rips Uniqueness \newresult[]}

As previously mentioned, the Vietoris-Rips functor is surjective.
In this section we present the new result that under certain technical assumptions the Vietoris-Rips is the unique surjective $\gen$ clustering functor.

In chapter \ref{chapter__hierarchical} we will discuss the implications this has on \textsc{Kleinberg}'s theorem \ref{thm:kleinberg}.

\begin{definition}{}{regular}
    A clustering functor $\Cf: \M \to \C$ is \emph{regular} if for all $(X,d) \in \ob(\M)$ there exists some $\lambda \in (0, 1)$ such that
    $$
    \Cf(X,d) = \Cf(X, \lambda \cdot d).
    $$
    
    \newresult[new def, make sure this makes sense]
\end{definition}

Notice that $\Rf_\delta$ is regular. The reason we ask for $\lambda \in (0,1)$ and not $\lambda \in (1, \infty)$ is that this corresponds to the regularity condition \ref{rem:regularity_of_dendrograms} for dendrograms.\par

\begin{myremark}{}{regularity_classical_clustering_functors}
    \medskip It might seem overly restrictive to ask for regularity.
    However, if we take some $(X, d) \in \ob(\M)$ and consider the function 
    $$
    \lambda \mapsto \Cf(X, \lambda \cdot d),
    $$
    which will be piecewise constant and takes only finitely many values.
    Regularity ensures that this function is constant on $(a, b]$ for some $a < b$.
\end{myremark}

Assuming regularity and building on lemma \ref{lem:surjective_implies_eventually_discrete}, we can now finally show that the Vietoris-Rips functor is the only surjective regular $\gen$ clustering functor.

\begin{theorem}{}{uniqueness_of_surjective_regular_functors}
    Let $\Cf: \gen \to \C$ then the following are equivalent:

    \begin{itemize}
        \item $\Cf$ is surjective and regular,
        \item $\Cf = \Rf_{\delta}$ for some $\delta > 0$.
    \end{itemize}
    \newresult[make sure this makes sense]
\end{theorem}

\begin{lemma}{}{surjective_implies_splitting}
    Let $\Cf: \M \to \C$ be a surjective regular clustering functor. Then $\Cf$ is splitting at some $\delta > 0$.

    \newresult[make sure this makes sense]

    \todo[maybe remark that regularity is necessary]
\end{lemma}

\begin{proof}[Proof of Lemma]
    Let $\lambda \ge \lambda'$, we consider the identity
    \begin{align*}
        \mathrm{id}: (X, \lambda \cdot d) &\longrightarrow (X, \lambda' \cdot d),\\
        x &\longmapsto x,
    \end{align*}
    which is distance non-increasing, so by functoriality and by refinement via the identity \eqref{eq:refinement_via_identity} we have
    \begin{equation}
    \label{eq:lemma_5_19_1}
    \Cf(X, \lambda \cdot d) \refines_\mathrm{id} \Cf(X, \lambda' \cdot d) \implies \Cf(X, \lambda \cdot d) \refines \Cf(X, \lambda' \cdot d)
    \end{equation}
    for all $\lambda \ge \lambda'$.

    Consider how $(X,d) = \Delta_2(\lambda)$ it is clear that
    \begin{align*}
        \R_{\geq0} &\longrightarrow \P(X), \\
        \lambda &\longmapsto \Cf(\Delta_2(\lambda))
    \end{align*}
    is piecewise constant and can take at most two values (either discrete or trivial) but by lemma \ref{lem:surjective_implies_eventually_discrete} this function takes exactly two values and by \eqref{eq:lemma_5_19_1} this function is also monotonically decreasing (with respect to $\le$ on $\R_{\geq0}$ and $\refines$ on $\P(X)$).
    So we can find some $\delta_0 > 0$ such that $\Cf(\Delta_2(\delta))$ is trivial and $\Cf(\Delta_2(\delta'))$ is discrete for all $\delta < \delta_0 < \delta'$.

    As for the value at $\delta_0$ we recall the previous remark \ref{rem:regularity_classical_clustering_functors} and conclude that $\Cf(\Delta_2(\delta_0))$ is trivial.
    \newresult[check this]
\end{proof}

\begin{proof}[Proof of Theorem]
    For the first implication recall that in proposition \ref{prop:vietoris_rips_is_surjective} we have already shown that $\Rf_\delta$ is surjective. Moreover, it is also regular.

    Assuming that $\Cf$ is regular and surjective, from the above lemma we get that $\Cf$ is splitting at some $\delta > 0$ so by \ref{prop:splitting_vietoris_gen} we have that $\Cf = \Rf_{\delta}$.
\end{proof}

\section{Scale Invariant Clustering Functors}

We will quickly talk about scale invariance inspired by \textsc{Kleinberg}'s conditions from theorem \ref{thm:kleinberg}, discussed in \cite[Sec.~6.6]{Carlsson2010}, and see where this fails.

\begin{definition}{Scale Invariance}{scale_invariance}
    A clustering functor $\Cf: \M \to \C$ is called \emph{scale invariant} if for all $\lambda > 0$ and $(X,d) \in \ob(\M)$ we have:
    \begin{equation*}
        \Cf((X,d)) = \Cf(X,\lambda \cdot d)).
    \end{equation*}
\end{definition}

We now get two interesting distinct behavior of scale invariant clustering functors. First we consider the case of $\gen$.

\begin{proposition}{\cite[Thm.~6.5]{Carlsson2010}}{}
    Let $\Cf: \gen \to \C$ be a scale invariant clustering functor then either
    \begin{enumerate}
        \item $\Cf(X,d)$ is trivial for all $(X,d) \in \ob(\gen)$
        \item $\Cf(X,d)$ is discrete for all $(X,d) \in \ob(\gen)$
    \end{enumerate}
\end{proposition}

\begin{proof}
    By scale invariance we either have that $\Cf(\Delta_2(\delta))$ is trivial or discrete for all $\delta > 0$.

    Let $|X| \ge 2$ otherwise the statement is clear. Then for any $x \neq x'$ in $X$ we can find $\delta, \delta' > 0$ and morphisms in $\gen$
    $$
    \Delta_2(\delta) \overset{f}\longrightarrow X \overset{g}\longrightarrow \Delta_2(\delta')
    $$
    such that $f(1) = x, f(2) = x', g(x) = 1$ and $g(x') = 2$. By functoriality we get
    $$
    \Cf(\Delta_2(\delta)) \refines_f \Cf(X,d) \refines_g \Cf(\Delta_2(\delta')).
    $$
    And since $x \neq x'$ was arbitrary in $X$ we get that if
    \begin{itemize}
        \item $\Cf(\Delta_2(\delta))$ is trivial then $\Cf(X)$ is trivial.
        \item $\Cf(\Delta_2(\delta))$ is discrete then $\Cf(X)$ is discrete.
    \end{itemize}
\end{proof}

In case of $\inj$ we have a more interesting behavior.

\begin{proposition}{\cite[Thm.~6.6]{Carlsson2010}}{}
    Let $\Cf: \inj \to \C$ be a scale invariant functor then there exists a $k \in \N \sqcup \{0, \infty\}$ such that for all $(X,d) \in \ob(\inj)$:

    \begin{itemize}
        \item If $|X| > k$ then $\mathfrak{C}(X,d)$ is trivial.
        \item If $|X| \le k$ then $\mathfrak{C}(X,d)$ is discrete.
    \end{itemize}

    Notice that if $k \in \{0, \infty\}$ then we recover the behavior from $\gen$.
\end{proposition}

\begin{proof}   
    Notice that for $n \le n'$ there exists a morphism in $\inj$
    $$
    \Delta_n(\delta) \longrightarrow \Delta_{n'}(\delta).
    $$
    Therefore, we get that
    $$
    \Cf(\Delta_n(\delta)) \refines \Cf(\Delta_{n'}(\delta)).
    $$
    On the other hand, any permutation of $\Delta_n(\delta)$ is also a morphism in $\inj$. This gives us that $\Cf(\Delta_n(\delta))$ is either discrete or trivial.

    So together we get that there exists some $k \in \N \sqcup \{0, \infty\}$ such that
    \begin{itemize}
        \item $\forall n > k: \Cf(\Delta_n(\delta))$ is trivial.
        \item $\forall n \le k: \Cf(\Delta_n(\delta))$ is discrete.
    \end{itemize}
    By scale invariance this does not depend on $\delta$. We can now repeat the same argument as in the previous proposition to get the statement\footnote{By using $n = |X|$ we can find morphisms $f,g$ in $\inj$.}.
\end{proof}

Following this we immediately see that scale invariant clustering functors can not be surjective.