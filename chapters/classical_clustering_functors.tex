\chapter{Classification of Classical Clustering Functors}
In this chapter any clustering functor is of the classical type.

An important (classical) clustering functor is the Vietoris-Rips functor.
In particular, we will later see that it exhibits certain unique properties.

\begin{defprop}{Vietoris-Rips Functor}{}
    Let $\delta > 0$ and $\M \in \{\iso, \inj, \gen\}$. The Vietoris Rips functor $\Rf_\delta: \M \to \C$ assigns to each metric space $(X,d) \in \M$ the partition $(X,P)$ where $\sim_P$ is the equivalence generated by:
    \begin{equation}
        \label{eq:vietoris_rips_equivalence_relation}
        \forall x,y \in X: d(x,y) \leq \delta \implies x \sim_P y
    \end{equation}
    \todo[check left/right regularity; this is the single source of truth]
\end{defprop}

One could use a proper inequality in \eqref{eq:vietoris_rips_equivalence_relation}. The entire theory we are about to present would still hold, provided we tweak certain definitions accordingly in particular \ref{def:dendogram}.

\begin{proof}
It is sufficient to show that $\Rf_\delta$ is $\gen$ factorial by remark \ref{rem:induced_functor_by_inclusion} functoriality over $\iso$ and $\inj$ will follow.

Let $X,Y \in \ob(\gen)$ and $(X,P_X) := \Rf(X)$ as well as $(Y,P_Y) := \Rf(Y)$.
Take any $f \in \mor_\gen(X,Y)$, recall that $f$ is distance non-increasing.
We have to show that 
$$P_X \refines f_*(P_Y).$$
Indeed, let $x,y \in X$ such that $d(x,y) \leq \delta$.
Then we have $d(f(x), f(y)) \leq d(x,y) \leq \delta$ and therefore $f(x) \sim_{P_Y} f(y)$.
By taking the transitive closure we get the statement.
\end{proof}

\begin{myremark}{$\iso$ Clustering Functors}{}
Let $\mathcal{I}$ denote a collection of representatives of isometry classes of finite metric spaces.
For each $X \in \mathcal{I}$ consider the isometry group $\mathrm{Iso}(X)$. \par

\medskip This group acts on $\mathfrak{P}(X)$ via $(\phi, P) \mapsto \phi_*(P)$.
Let $\Xi_X \subseteq \mathfrak{P}(X)$ denote the set of fixed points of this group action. \par

\medskip A clustering functor $\Cf: \iso \to \C$ is uniquely determined by a choice of $P_X \in \Xi_X$ for each $X \in \mathcal{I}$.
\end{myremark}

Clearly $\iso$ permits may be clustering functors.
In some sense $\iso$ clustering functors can be thought of as any \emph{algorithm} which \emph{does not consider any arbitrary ordering} of the data points.
It is in fact for this reason that algorithms like single linkage clustering \ref{section__linkage_clustering} is not even $\iso$ functorial.

From now on, unless otherwise mentioned, we use $\M \in \{\inj, \gen\}$.

\section{Excessive and Representable Clustering Functors}
\begin{definition}{Excessive Clustering Functors}{}
A clustering functor $\Cf: \M \to \C$ is called \emph{excessive} if for every $(X,d) \in \ob(\M)$ and $(X,P) = \Cf(X,d)$ we have that for every block $X_\alpha \in P$:
$$
\Cf(X_\alpha, d|_{X_\alpha \times X_\alpha}) = (X, \{X_\alpha\})
$$
\end{definition}

Let $\Omega$ be a family of finite non-empty metric spaces. Such $\Omega$'s can be used to construct clustering functors. We think of $\Omega$ as being a collection of \emph{patters} and our clustering algorithm as detecting these \emph{patterns}.



\begin{definition}{Representable Clustering Functors}{}
We define the clustering functor \emph{represented by $\Omega$}
$$
\Cf^\Omega \M \to \C
$$
where $\Cf(X,d) = (X, P)$ such that $\sim_P$ 
is the equivalence relation generated by:
\begin{equation*}
    \forall x,y \in X: \ \exists \omega \in \Omega \,\exists \phi \in \mor_\M(\omega, X) \ \st \ \{x,y\} \subset \image(\phi) \implies x \sim_P y.
\end{equation*}
Additionally, $\Cf$ is said to be representable if there exists some $\Omega$ such that $\Cf = \Cf^\Omega$.
\end{definition}

This definition is valid for any $\Omega$, but we will see that imposing certain conditions on $\Omega$ will yield interesting properties of $\Cf^\Omega$.

\begin{myremark}{}{}
Notice that for $X \in \Omega$ we have $\Cf^\Omega(X) = (X, \{X\})$.
\end{myremark}

This leads to an alternative characterization of $\Cf^\Omega$.

\begin{proposition}{}{}
For any clustering functor $\Cf$ such that $\Cf(X)$ is trivial for all $X \in \Omega$ we have
$$
\Cf^\Omega \refines \Cf
$$
\end{proposition}

\begin{proof}
\newresult[]
\end{proof}

\begin{theorem}{}{}
Let $\M \in \{\inj, \gen\}$. A clustering functor $\Cf: \M \to \C$ is representable if and only if it is excessive.
\end{theorem}

\begin{proof}
\todo
\end{proof}

\subsection{Factorization Theorem}
\todo[this subsection is kind of irrelevant]

\begin{definition}{Bounded Generative Model}{}
We say that $\Omega$ is \emph{bounded} if for all $k \in \N$ we have
$$
\sup\{\diam(X): X \in \Omega \text{ and } |X| = k\} < \infty
$$
\end{definition}
Notice that if $|\Omega| < \infty$ then $\Omega$ is clearly bounded.

\begin{definition}{Generative Metric}{}
\end{definition}

\begin{theorem}{}{}
    Factorization Theorem
\end{theorem}

\section{Surjective Clustering Functors}

\begin{definition}{Surjective Clustering Functors}{}
    A classical clustering functor $\Cf: \M \to \C$ is called \emph{surjective} if for every finite set $X$ and every $P_X \in \P(X)$ there exists a metric $d_X$ on $X$ such that

    \begin{equation*}
        \Cf(X,d_X) = (X,P_X)
    \end{equation*}

\end{definition}

The important property of the Vietoris rips functor that we used in the previous factorization theorem was that it is surjective. We can actually express this in a more general way:

\begin{proposition}{}{}
    Let $\mathfrak{S}: \M \to \C$ be a surjective functor. Then for any clustering functor $\Cf: \M \to \C$ there exists a functor $\Tf_\Cf: \M \to \M$ that changes the metric such that

    \begin{equation*}
        \Cf = \mathfrak{S} \circ \Tf_\Cf
    \end{equation*}

    \newresult
\end{proposition}

A surprising fact about surjective clustering functors is given by the following lemma:

\begin{lemma}{}{surjective_implies_eventually_discrete}
    Let $\Cf: \M \to \C$ be a surjective clustering functor and $(X,d)$ a finite metric space. Then there exists $\lambda_0,\lambda_1 > 0$ such that
    \begin{enumerate}
        \item $\Cf(X,\mu \cdot d)$ is trivial for all $0 < \lambda \le \lambda_0$
        \item $\Cf(X,\lambda \cdot d)$ is discrete for all $\lambda \ge \lambda_1$
    \end{enumerate}

    \newresult
\end{lemma}

\section{Splitting}

\begin{definition}{}{}
    A clustering functor $\Cf: \M \to \C$ is called \emph{splitting} at $\delta_0 > 0$ if we have
    \begin{enumerate}
        \item $\Cf(\Delta_2(\delta))$ is trivial for all $\delta \leq \delta_0$.
        \item $\Cf(\Delta_2(\delta))$ is discrete for all $\delta > \delta_0$.
    \end{enumerate}
\end{definition}

\begin{definition}{}{}
    A clustering functor $\Cf: \M \to \C$ is \emph{left-regular} if for all $(X,d) \in \ob(\M)$ there exists some $\lambda \in (0, 1)$ such that
    $$
    \Cf(X,d) = \Cf(X, \lambda \cdot d).
    $$
    
    \newresult[new def, make sure this makes sense]
\end{definition}

Notice that $\Rf_\delta$ is left-regular. In fact, we could have also defined the notion of \emph{right-regular}. See the previous remark \ref{rem:left_regularity_of_dendograms}.\par

\begin{myremark}{}{left_regularity_classical_clusteirng_functors}
    \medskip It might seem overly restrictive to ask for left-regularity.
    However, if we take some $(X, d) \in \ob(\M)$ and consider the function 
    $$
    \lambda \mapsto \Cf(X, \lambda \cdot d),
    $$
    then left-regularity ensures that this function is constant on $(a, b]$ for some $a < b$.

    \newresult[make sure this makes sense]
\end{myremark}



\begin{proposition}{}{splitting_vietoris_inj}
    Let $\Cf: \inj \to \C$ be a left-regular clustering functor that splits at $\delta > 0$. Then we have $\Rf_\delta \refines \Cf$.

    \newresult[make sure this makes sense]
\end{proposition}

\begin{proof}
    \todo[]
\end{proof}

\begin{proposition}{}{splitting_vietoris_gen}
    Let $\Cf: \gen \to \C$ be a left-regular clustering functor then $\Cf$ is splitting at $\delta > 0$ if and only if $\Rf_\delta = \Cf$.

    \newresult[make sure this makes sense]
\end{proposition}

\begin{proof}
    It remains to show that $\Cf \refines \Rf_\delta$.

    \todo[]
\end{proof}

\subsection{Vietoris-Rips Uniqueness}

As previously mentioned the Vietoris-Rips functor is surjective. We will now show that under the assumption of left-regularity it is in fact also the only surjective $\gen$ clustering functor.

\begin{lemma}{}{}
    Let $\Cf: \M \to \C$ be a surjective left-regular clustering functor. Then $\Cf$ is splitting at some $\delta > 0$.

    \newresult[make sure this makes sense]
\end{lemma}

\begin{theorem}{}{}
    Let $\Cf: \gen \to \C$ be a surjective left-regular clustering functor. Then
    $$
    \Cf = \Rf_{\delta}.
    $$
    Where $\delta$ is given by the previous lemma.

    \newresult[make sure this makes sense]
\end{theorem}

\section{Scale Invariant Clustering Functors}

\begin{definition}{Scale Invariance}{scale_invariance}
    A clustering functor $\Cf: \M \to \C$ is called \emph{scale invariant} if for all $\lambda > 0$ and $(X,d) \in \ob(\M)$ we have:
    \begin{equation*}
        \Cf((X,d)) = \Cf(X,\lambda \cdot d)).
    \end{equation*}
\end{definition}

\begin{proposition}{Scale Invariance in $\gen$}{}
    Let $\Cf: \gen \to \C$ be a scale invariant functor then either
    \begin{enumerate}
        \item $\Cf(X,d)$ is trivial for all $(X,d) \in \ob(\gen)$
        \item $\Cf(X,d)$ is discrete for all $(X,d) \in \ob(\gen)$
    \end{enumerate}
\end{proposition}

\begin{proof}
    $\Delta_2(\delta) \to X \to \Delta_2(\delta')$
\end{proof}

\begin{proposition}{Scale Invariance in $\inj$}{}
    Let $\Cf: \inj \to \C$ be a scale invariant functor then...
\end{proposition}

\begin{proof}
    $\Delta_{|X|}(\delta) \to X \to \Delta_{|X|}(\delta')$
\end{proof}


% new layout above ^^^
\chapter*{Old classical clustering functors}
% old layout below vvv


\section{Elementary Properties}
\subsection{Excessive Clustering Functors}
\begin{definition}{Excessive Clustering Scheme}{}
A classical clustering functor $\Cf: \M \to \C$ is called \emph{excessive} if for every $(X,d) \in \ob(\M)$ and $(X,P_X) = \Cf(X,d)$ we have that for every $X_\alpha \in P_X$
\begin{equation*}
    \Cf(X_\alpha, d|_{X_\alpha \times X_\alpha}) = (X,\{X_\alpha\}).
\end{equation*}
\end{definition}
In other words if $\Cf$ is excessive it can be thought of as being nilpotent in a certain sense.

\begin{myremark}{Excessive Clustering Algorithms}{}
The notion of excessiveness exists in the more general setting of clustering alogrithms (which are not necessarily clustering functors).
\end{myremark}

\todo[reference to first chapter]
In particular there we have encountered examples of non excessive clustering algorithms.

\todo[explain why agglomerative / kmeans ... clustering is non excessive]

\todo[give an example of a excessive clustering that we have seen before]

\subsection{Surjective Clustering Functors}
\begin{definition}{Surjective Clustering Functor}{}
A classical clustering functor $\Cf: \M \to \C$ is called \emph{surjective} if for every finite set $X$ and every $P_X \in \P(X)$ there exists a metric $d_X$ on $X$ such that
\begin{equation*}
    \Cf(X,d_X) = (X,P_X)
\end{equation*}
\end{definition}

We have seen this concept previously when discussing \textsc{Kleinberg}'s theorem \ref{thm:kleinberg}, there it was called richness \ref{def:richness}.

As previously mentioned the $k$-means clustering algorithm\ref{def:kmeans_clustering} is clearly not surjective. As it limits the number of clusters.
\todo[better wording]

We will see later that surjective clustering functors are in some cases unique. Another relatively straightforward property of surjective functors is that they factor any other clustering functor:

\begin{proposition}{}{universality_of_surjective_functors}
Let $\mathfrak{S}: \M \to \C$ be a surjective functor. Then for any clustering functor $\Cf: \M \to \C$ there exists a functor $\Tf_\Cf: \M \to \M$ that changes the metric such that

\begin{equation*}
\Cf = \mathfrak{S} \circ \Tf_\Cf
\end{equation*}
\end{proposition}

\mynote[move below to chapter 7?]
A surprising fact about surjective clustering functors is given by the following lemma:

\begin{lemma}{}{surjective_implies_eventually_discrete}
Let $\Cf: \M \to \C$ be a surjective clustering functor and $(X,d)$ a finite metric space. Then there exists $\lambda_0, \mu_0 > 0$ such that
\begin{enumerate}
    \item $\Cf(X,\lambda \cdot d)$ is discrete for all $\lambda > \lambda_0$
    \item $\Cf(X,\mu \cdot d)$ is trivial for all $0 < \mu \le \mu_0$
\end{enumerate}
\mynote[dedupe this from chapter 7]
\end{lemma}

Indeed this now motivates us to define the smallest resp. largest values for which the condition in the lemma holds. This gives us:

\begin{definition}{}{}
Let $\Cf: \M \to \C$ be surjective clustering functor. Due to the previous lemma we can define
\begin{align*}
\diam^\Cf(X) &:= \sup\{ \lambda > 0: \Cf(X,\lambda \cdot d) \text{ is trivial}\} < \infty\\
\sep^\Cf(X) &:= \inf\{ \lambda > 0: \Cf(X,\lambda \cdot d) \text{ is discrete}\} < \infty
\end{align*}
called the \emph{intrinsic separation} and \emph{diameter} of $X$. 
\end{definition}
Additionally, it is easy to check that we can use $\lambda_0 = \sep^\Cf(X)$ and $\mu_0 = \diam^\Cf(X)$ in the previous lemma.

Later we will use $\sep^\Cf(X)$ and $\diam^\Cf(X)$ but first we have to show an important property.

\begin{lemma}{}{mutliplicativity_of_intrinsic_sizes}
Let $\Cf: \M \to \C$ be surjective. Then for all $(X,d) \in \ob(\M)$ and $\lambda > 0$ we have
\begin{align*}{}{}
    \diam^\Cf(X,\lambda \cdot d) &= \lambda \cdot \diam^\Cf(X,\lambda) \\
    \sep^\Cf(X,\lambda \cdot d) &= \lambda \cdot \sep^\Cf(X,\lambda)
\end{align*}
\end{lemma}

\begin{proposition}{Classification of $\iso$ Clustering Functors}{}
Let $\Cf: \iso \to \C$ be a clustering functor. Then there exists a choice ... moreover any such choice is a clustering functor.
\end{proposition}
In light of the previous proposition let now $\M \in \{\inj, \gen\}$


A very important functor is the:
\begin{definition}{Vietoris Rips Functor}{}
$\Rf_\delta$
\end{definition}

\todo[to what degree should I discuss the relevance of VR in other domains?]



\begin{proposition}{Vietoris Rips Functor}{}
$\Rf_\delta$ is an excessive and surjective clustering functor.
\end{proposition}

\section{Representable Clustering Functors}


$\Cf^\Omega$ is indeed a clustering functor. Let $f: X \to Y$ be a morphism and $x \sim y$. Then we have an $\omega \in \Omega$ and a $\phi \in \mor_\M(\omega, X)$ such that \eqref{eq:represented_clustering_functor_condition} holds. But then $f \circ \phi \in \mor_\M(\omega,Y)$ has the same properties and it follows that $f(x) \sim f(y)$.

\begin{myremark}{}{}

$$
\Cf^\Omega(\omega) = (\omega, \{\omega\})
$$

We also have $\Cf^\Omega$ is the finest clustering functor such that $\omega \in \Omega$ get mapped into the trivial partition.
\end{myremark}

\begin{proposition}{Surjective Generative Model}{}
\newresult
Let $\Omega$ be a generative model then the following are equivalent:
\begin{enumerate}
    \item $\Cf^\Omega$ is surjective
    \item $\exists \omega \in \Omega$ with $|\omega| = 2$ and for all $k \in \N$ we have 
    $$
    \sup\{\diam(\omega): \omega \in \Omega \text{ and } |\omega| = k\} < \infty.
    $$ 
\end{enumerate}
furthermore such a generative model $\Omega$ is called \emph{surjective}.
\end{proposition}





\begin{theorem}{Excessive Clustering Schemes}{}
Let $\M \in \{\inj, \gen\}$ then a clustering functor $\Cf: \M \to \C$ is representable if and only if it is excessive.
\end{theorem}

\begin{definition}{Generative Metric \cite{Carlsson2010}}{}
Let $\Omega$ be a generative model. Let $(X,d)$ be a metric space, we define a symmetric positive definite function $W^\Omega: X \times X \to [0,+\infty]$. With:
\begin{equation*}
W^\Omega(x,y) := \begin{cases}
    1/2 & 
    \begin{array}{cc}
         \text{if } \exists \, \omega \in \Omega \ \exists \, \phi \in \mor_{\M}(\omega, (X,d))\\
         \text{ such that } \{x,y\} \subset \image(\phi)
    \end{array}\\
    1 & \hfil \text{else}
\end{cases}
\end{equation*}
\end{definition}




\begin{myremark}{}{}
Let $d_{W^\Omega}$ be the shortest path distance metric \ref{def:shortest_dist_metric} then $(X,d) \mapsto (X,d_{W^\Omega})$ induces a functor $\Tf^\Omega: \M \to \M$.
\end{myremark}

\begin{theorem}{Factorizing Theorem}{}
Let $\Omega$ \footnote{\cite{Carlsson2010} provides a construction of $\Tf^\Omega$ that works for finite generative models.} be a generative model then we have
\begin{equation*}
\Cf^\Omega = \Rf_1 \circ \mathfrak{T}^\Omega
\end{equation*}
\end{theorem}

\section{Splitting Clustering Functors}

\begin{definition}{Splitting}{}
We say that a clustering functor $\Cf: \M \to \C$ is \emph{splitting} at $\delta_0 > 0$ if we have

\begin{enumerate}
    \item $\Cf(\Delta_2(\delta))$ is trivial for all $\delta < \delta_0$.
    \item $\Cf(\Delta_2(\delta))$ is discrete for all $\delta \geq \delta_0$.
\end{enumerate}

\todo[check inequalities, check with def of vietoris-rips]
\end{definition}

\begin{proposition}{}{splitting_inj}
Let $\Cf: \inj \to \C$ be a clustering functor that splits at $\delta > 0$. Then we have $\Rf_\delta \refines \Cf$.
\end{proposition}

\begin{proposition}{}{}
Let $\Cf: \gen \to \C$ be a clustering functor then $\Cf$ is splitting at $\delta > 0$ if and only if $\Rf_\delta = \Cf$.
\end{proposition}

\begin{proof}
To show $\Rf_\delta \refines \Cf$ we can adapt the proof of the previous proposition \ref{prop:splitting_inj}. It therefore remains to show $\Cf \refines \Rf_\delta$. \todo
\end{proof}

\begin{lemma}{}{}
\newresult
Let $\Cf: \M \to \C$ be a surjective clustering functor. Let $(X,d) \in \ob(\M)$ then there exists $\lambda \geq \lambda' > 0$ such that
\begin{enumerate}
    \item $\Cf(X, \lambda \cdot d)$ is discrete
    \item $\Cf(X, \lambda' \cdot d)$ is trivial
\end{enumerate}
\end{lemma}

\begin{corollary}{}{}
\newresult

\todo[maybe we can remove this corollary and inline it into the proof of the next]
Let $\Cf: \M \to \C$ be a surjective clustering functor. Then there exists a $\delta > 0$ such that $\Cf$ splits at $\delta$.
\end{corollary}

\begin{corollary}{}{}
\newresult
Let $\M \in \{\gen, \inj\}$ and $\Cf: \M \to \C$ a surjective clustering functor then $\Cf \refines \Rf_\delta$ for some $\delta > 0$. More over we have $\Cf = \Rf_\delta$ if $\M = \gen$
\end{corollary}

\section{Scaling Invariant Clustering Functors}

\begin{definition}{Scale Invariance}{scale_invariance}
A clustering functor $\Cf: \M \to \C$ is called \emph{scale invariant} if for all $\lambda > 0$ and $(X,d) \in \ob(\M)$ we have:
\begin{equation*}
    \Cf((X,d)) = \Cf(X,\lambda \cdot d)).
\end{equation*}
\end{definition}

\begin{proposition}{Scale Invariance in $\gen$}{}
Let $\Cf: \gen \to \C$ be a scale invariant functor then either
\begin{enumerate}
    \item $\Cf(X,d)$ is trivial for all $(X,d) \in \ob(\gen)$
    \item $\Cf(X,d)$ is discrete for all $(X,d) \in \ob(\gen)$
\end{enumerate}
\end{proposition}

\begin{proof}
$\Delta_2(\delta) \to X \to \Delta_2(\delta')$
\end{proof}

\begin{proposition}{Scale Invariance in $\inj$}{}
Let $\Cf: \inj \to \C$ be a scale invariant functor then...
\end{proposition}

\begin{proof}
$\Delta_{|X|}(\delta) \to X \to \Delta_{|X|}(\delta')$
\end{proof}